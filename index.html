<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Cinematic Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --bg-deep: #050505;
            --bg-card: #0f0f0f;
            --accent: #3b82f6;
            --border: #1f1f1f;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: #fafafa;
            letter-spacing: -0.01em;
        }

        .glass-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .option-btn {
            background: #18181b;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
            color: #a1a1aa;
            text-align: center;
        }

        .option-btn:hover {
            background: #27272a;
            color: #fff;
        }

        .option-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .loader {
            border-top-color: white;
            animation: spinner 1s linear infinite;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #27272a;
            border-radius: 10px;
        }

        .code-block {
            background: #000;
            border: 1px solid var(--border);
            font-family: 'SF Mono', 'Fira Code', monospace;
        }

        .btn-primary {
            background: var(--accent);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            filter: brightness(1.1);
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.4);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 lg:p-12">
    <div class="max-w-[1400px] mx-auto">
        <!-- Modern Header -->
        <header class="mb-12 flex flex-col items-center">
            <div class="mb-6 flex space-x-2">
                <div class="h-1 w-8 rounded-full bg-blue-500"></div>
                <div class="h-1 w-4 rounded-full bg-zinc-800"></div>
                <div class="h-1 w-4 rounded-full bg-zinc-800"></div>
            </div>
            <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight mb-3">PRODUCTION ENGINE</h1>
            <p class="text-zinc-500 font-medium uppercase text-[10px] tracking-[0.4em]">Sequential Shot-by-Shot Visual Orchestrator</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            <!-- Parameters Sidebar -->
            <div class="lg:col-span-5 space-y-6">
                <div class="glass-card rounded-3xl p-6 md:p-8 space-y-6">
                    <!-- Concept -->
                    <div>
                        <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-3 ml-1">Project Concept</label>
                        <input id="topic" type="text" placeholder="Enter your core message or story theme..." 
                            class="w-full bg-zinc-900/50 border border-zinc-800 rounded-xl px-5 py-4 text-sm focus:outline-none focus:border-blue-500 transition-all text-white placeholder:text-zinc-700">
                    </div>

                    <!-- Niche -->
                    <div>
                        <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-3 ml-1">Production Niche</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2" id="nicheGrid">
                            <button onclick="selectOption('niche', 'Explainer Video')" data-value="Explainer Video" class="option-btn p-3 rounded-xl text-[10px] active">Explainer</button>
                            <button onclick="selectOption('niche', 'Motion Graphics')" data-value="Motion Graphics" class="option-btn p-3 rounded-xl text-[10px]">Motion Gfx</button>
                            <button onclick="selectOption('niche', 'Mental Health')" data-value="Mental Health" class="option-btn p-3 rounded-xl text-[10px]">Mental Health</button>
                            <button onclick="selectOption('niche', 'Business & Tech')" data-value="Business & Tech" class="option-btn p-3 rounded-xl text-[10px]">Biz & Tech</button>
                            <button onclick="selectOption('niche', 'Documentary')" data-value="Documentary" class="option-btn p-3 rounded-xl text-[10px]">Docu</button>
                            <button onclick="selectOption('niche', 'Product Showcase')" data-value="Product Showcase" class="option-btn p-3 rounded-xl text-[10px]">Product</button>
                        </div>
                    </div>

                    <!-- Aesthetic -->
                    <div>
                        <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-3 ml-1">Visual Aesthetic</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2" id="styleGrid">
                            <button onclick="selectOption('style', 'Minimalist')" data-value="Minimalist" class="option-btn p-3 rounded-xl text-[10px] active">Minimalist</button>
                            <button onclick="selectOption('style', 'Hyper-Realistic')" data-value="Hyper-Realistic" class="option-btn p-3 rounded-xl text-[10px]">Realistic</button>
                            <button onclick="selectOption('style', 'Anime / Manga')" data-value="Anime / Manga" class="option-btn p-3 rounded-xl text-[10px]">Anime</button>
                            <button onclick="selectOption('style', '3D Octane Render')" data-value="3D Octane Render" class="option-btn p-3 rounded-xl text-[10px]">3D Octane</button>
                            <button onclick="selectOption('style', 'Retro Film 35mm')" data-value="Retro Film 35mm" class="option-btn p-3 rounded-xl text-[10px]">35mm Film</button>
                            <button onclick="selectOption('style', 'Vaporwave/Cyber')" data-value="Vaporwave/Cyber" class="option-btn p-3 rounded-xl text-[10px]">Cyberpunk</button>
                        </div>
                    </div>

                    <!-- Character Section -->
                    <div class="pt-6 border-t border-zinc-800/50 space-y-4">
                        <label class="block text-[10px] font-bold text-blue-500 uppercase tracking-widest mb-1">Subject Orchestration</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-2" id="characterGrid">
                            <button onclick="selectOption('character', 'None')" data-value="None" class="option-btn p-2.5 rounded-xl text-[9px]">None</button>
                            <button onclick="selectOption('character', 'Male Lead')" data-value="Male Lead" class="option-btn p-2.5 rounded-xl text-[9px] active">Male</button>
                            <button onclick="selectOption('character', 'Female Lead')" data-value="Female Lead" class="option-btn p-2.5 rounded-xl text-[9px]">Female</button>
                            <button onclick="selectOption('character', 'Diverse Group')" data-value="Diverse Group" class="option-btn p-2.5 rounded-xl text-[9px]">Group</button>
                        </div>
                        <div class="grid grid-cols-2 gap-2" id="consistencyGrid">
                            <button onclick="selectOption('consistency', 'Random')" data-value="Random" class="option-btn p-2.5 rounded-xl text-[10px]">Random Subjects</button>
                            <button onclick="selectOption('consistency', 'Persistent')" data-value="Persistent" class="option-btn p-2.5 rounded-xl text-[10px] active">Consistent Profile</button>
                        </div>
                    </div>

                    <!-- Tone & Platform -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pt-6 border-t border-zinc-800/50">
                        <div>
                            <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2 ml-1">Tone</label>
                            <select id="toneSelect" class="w-full bg-zinc-900 border border-zinc-800 rounded-xl px-3 py-3 text-[10px] text-zinc-200 focus:outline-none">
                                <option value="Motivational">Motivational</option>
                                <option value="Philosophical">Philosophical</option>
                                <option value="Urgent/Hype">Urgent</option>
                                <option value="Sarcastic">Sarcastic</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2 ml-1">Platform</label>
                            <select id="platformSelect" class="w-full bg-zinc-900 border border-zinc-800 rounded-xl px-3 py-3 text-[10px] text-zinc-200 focus:outline-none">
                                <option value="YouTube">YouTube</option>
                                <option value="TikTok/Reels">Short Form</option>
                                <option value="LinkedIn">LinkedIn</option>
                            </select>
                        </div>
                    </div>

                    <button onclick="handleGenerate()" id="generateBtn" 
                        class="w-full btn-primary text-white font-bold uppercase text-[11px] tracking-[0.3em] py-5 rounded-2xl shadow-xl active:scale-[0.98] transition-all flex items-center justify-center gap-3">
                        <span id="btnText">EXECUTE BUILD</span>
                        <div id="btnLoader" class="hidden w-4 h-4 border-2 border-white/20 loader rounded-full"></div>
                    </button>
                </div>
            </div>

            <!-- Output Display -->
            <div class="lg:col-span-7 space-y-6">
                <div id="messageBox" class="hidden p-4 rounded-xl text-center font-bold text-[10px] uppercase tracking-widest"></div>

                <div id="outputContainer" class="hidden space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-500">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="glass-card rounded-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-[10px] font-bold uppercase tracking-widest text-zinc-500">VO Script</h3>
                                <button onclick="copyToClipboard('batchNarration', 'Script copied')" class="text-blue-500 text-[10px] font-bold uppercase">Copy</button>
                            </div>
                            <div id="batchNarration" class="code-block rounded-xl p-5 text-[11px] h-52 overflow-y-auto custom-scrollbar text-zinc-300"></div>
                        </div>
                        <div class="glass-card rounded-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-[10px] font-bold uppercase tracking-widest text-zinc-500">Sequential Batch</h3>
                                <button onclick="copyToClipboard('batchOutput', 'Prompts copied')" class="text-blue-500 text-[10px] font-bold uppercase">Copy All</button>
                            </div>
                            <div id="batchOutput" class="code-block rounded-xl p-5 text-[11px] h-52 overflow-y-auto custom-scrollbar text-zinc-400"></div>
                        </div>
                    </div>
                    <div class="glass-card rounded-2xl p-8 md:p-12 custom-scrollbar overflow-y-auto max-h-[100vh]">
                        <div id="mainOutput" class="prose prose-invert prose-blue max-w-none"></div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="h-[750px] flex flex-col items-center justify-center glass-card rounded-3xl border-dashed">
                    <p class="text-[11px] font-bold text-zinc-600 uppercase tracking-[0.5em]">Engine Standby</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Key must be empty string in this environment; it is provided at runtime.
        const apiKey = ""; 
        const model = "gemini-2.5-flash-preview-09-2025";
        
        let selections = {
            niche: 'Explainer Video',
            style: 'Minimalist',
            character: 'Male Lead',
            consistency: 'Persistent'
        };

        function selectOption(type, value) {
            selections[type] = value;
            const gridMap = { niche: 'nicheGrid', style: 'styleGrid', character: 'characterGrid', consistency: 'consistencyGrid' };
            const container = document.getElementById(gridMap[type]);
            container.querySelectorAll('button').forEach(btn => btn.classList.toggle('active', btn.dataset.value === value));
        }

        function showMessage(msg, isError = false) {
            const box = document.getElementById('messageBox');
            box.textContent = msg;
            box.className = `block mb-6 p-4 rounded-xl text-center font-bold text-[10px] tracking-widest ${isError ? 'bg-red-500/10 text-red-500' : 'bg-blue-500/10 text-blue-500'}`;
            setTimeout(() => box.classList.add('hidden'), 5000);
        }

        async function fetchWithRetry(url, options, maxRetries = 5) {
            let delay = 1000;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return await response.json();
                } catch (e) {
                    // Fail silently for retry
                }
                await new Promise(r => setTimeout(r, delay));
                delay *= 2;
            }
            throw new Error("API Connection Failed after several attempts. Please try again.");
        }

        async function handleGenerate() {
            const topic = document.getElementById('topic').value.trim();
            if (!topic) { showMessage("Concept topic required", true); return; }

            const btn = document.getElementById('generateBtn');
            const btnLoader = document.getElementById('btnLoader');
            const outputContainer = document.getElementById('outputContainer');
            const emptyState = document.getElementById('emptyState');

            btn.disabled = true;
            btnLoader.classList.remove('hidden');

            const tone = document.getElementById('toneSelect').value;
            const platform = document.getElementById('platformSelect').value;

            const systemPrompt = `You are a Pro Video Editor & Storyboard Artist.
            PRODUCTION SPECS:
            - Niche: ${selections.niche} | Style: ${selections.style}
            - Subject: ${selections.character} | Consistency: ${selections.consistency}
            - Platform: ${platform} | Tone: ${tone}

            STRICT INSTRUCTIONS:
            1. SHOT-BY-SHOT STORYTELLING: Generate a sequential, chronological narrative sequence of shots that tell a visual story.
            2. VISUAL CONTINUITY: If Persistent, define a 'Physical Identity Profile' and embed it in every prompt featuring that character.
            3. TECHNICAL PRECISION: Define specific Shot Sizes, Camera Movements, and Lighting.
            
            OUTPUT:
            - [Title & Visual Concept]
            - [Full Narrative Script]
            - [Story Beats: Sequential Shot List with Script Link + Professional Prompt]
            - "### SCRIPT_ONLY_START" for raw script.
            - "### BATCH_PROMPTS_START" for double-spaced raw sequential prompts.`;

            try {
                const data = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Create a professional sequential shot-by-shot production build for: "${topic}"` }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                const resultText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!resultText) throw new Error("Build response was empty.");
                
                const [main, scriptAndPrompts] = resultText.split("### SCRIPT_ONLY_START");
                const [script, prompts] = (scriptAndPrompts || "").split("### BATCH_PROMPTS_START");

                document.getElementById('mainOutput').innerHTML = main
                    .replace(/^## (.*$)/gim, '<h2 class="text-xl font-bold mt-8 mb-4 text-blue-500">$1</h2>')
                    .replace(/\*\*(.*)\*\*/g, '<strong class="text-white">$1</strong>')
                    .replace(/\n/g, '<br>');
                    
                document.getElementById('batchNarration').innerText = (script || "").trim();
                document.getElementById('batchOutput').innerText = (prompts || "").trim().split('\n').filter(l => l.length > 20).join('\n\n');

                emptyState.classList.add('hidden');
                outputContainer.classList.remove('hidden');
                showMessage("Workflow Build Complete");
            } catch (e) {
                showMessage(e.message, true);
            } finally {
                btn.disabled = false;
                btnLoader.classList.add('hidden');
            }
        }

        function copyToClipboard(id, msg) {
            const el = document.getElementById(id);
            const textarea = document.createElement('textarea');
            textarea.value = el.innerText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showMessage(msg);
        }
    </script>
</body>
</html>

